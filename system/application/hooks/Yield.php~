<?php  if (!defined('BASEPATH')) exit('No direct script access allowed');

/**
* Yield  ::  HOOKS
*
* Adds layout support :: Similar to RoR <%= yield =>
* '{yield}' will be replaced with all output generated by the controller/view.
*/
class Yield
{
  function doYield()
  {
    global $OUT;
  
    $CI =& get_instance();
    $output = $CI->output->get_output();
   

    if (isset($CI->layout))
    {
      if (!preg_match('/(.+).php$/', $CI->layout))
      {
        $CI->layout .= '.php';
      }
      $requested = BASEPATH . 'application/views/layouts/' . $CI->layout;
      $default = BASEPATH . 'application/views/layouts/default.php';
      
      if (file_exists($requested))
      {
        $layout = $CI->load->file($requested, true);
        $view = str_replace("{yield}", $output, $layout);
      }
      else
      {
        $layout = $CI->load->file($default, true);
        $view = str_replace("{yield}", $output, $layout);
      }
    }
    else
    {
      $view = $output;
    }
	
	$url = $_SERVER['SCRIPT_NAME']; $url = substr($url,0,strpos($url,".php")); $url = substr($url,0,(strlen($url) - strpos(strrev($url),"/"))); $url = ((empty($_SERVER['HTTPS']) OR $_SERVER['HTTPS'] === 'off') ? 'http' : 'https')."://".$_SERVER['HTTP_HOST'].$url; 

	$view = str_replace("{baseurl}", $url, $view);
	$view = str_replace("{nav}", $this->output_menu(), $view);

    $OUT->_display($view);
  }
	/*
	@Function output_menu()
	@Variables: outputMenu , outputMethod

	outputMenu Values:
	1 - Left/Right menu
	2 - Top Menu
	3 - View Menu

	outputMethod Values:
	list - ul li list
	*/
	function output_menu($outputMenu='1',$outputMethod='list')
	{
/*
		$url = $_SERVER['SCRIPT_NAME']; $url = substr($url,0,strpos($url,".php")); $url = substr($url,0,(strlen($url) - strpos(strrev($url),"/"))); $url = ((empty($_SERVER['HTTPS']) OR $_SERVER['HTTPS'] === 'off') ? 'http' : 'https')."://".$_SERVER['HTTP_HOST'].$url; 

		$CI =& get_instance();
		$CI->load->database();
		#$query = $CI->db->query("SELECT * FROM `functions` WHERE `fnEnabled` = '1' AND ".
		#				 "`fnAdminOnly` = '0' AND `fnMenuCategory` = '{$outputMenu}'".
		#				 " ORDER BY `id`");
	
		$output = "";		

		foreach($query->result_array() as $row)
		{
			if($outputMethod == 'list')
			{
				/*if($row['fnName'] == 'Research')
				{
					// Check that the user actually have builded that building.
					$userID = $CI->authlib->getUserId();
					// FIXME The variable of BID MIGHT change when we transfer to live server!
					#$query = $CI->db->query("SELECT id, uid, bid, end_time FROM `buildings_built` WHERE `uid` = '{$userID}' AND `bid` = '4' AND `end_time` < '".time()."'");
					#if($query->num_rows() > 0)
					$output.= "<li><img src=\"{$url}template/images/menu/".$row['fnImg']."\" alt=\"Placeholder\" /><a href=\"{$url}index.php/".$row['fnUrl']."\">". $row['fnName'] . "</a></li> \n";
				} else {
					$output.= "<li><img src=\"{$url}template/images/menu/".$row['fnImg']."\" alt=\"Placeholder\" /><a href=\"{$url}index.php/".$row['fnUrl']."\">". $row['fnName'] . "</a></li> \n";
				}
			 */ /*}

		}
*/
		return bool(false);
	}
}  

?> 
